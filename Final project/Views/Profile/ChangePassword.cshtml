@using Final_project.ViewModel.Customer

@model ChangePasswordViewModel
@{
    ViewData["Title"] = "Change Password";
}

<style>
    .password-change-container {
        max-width: 500px;
        margin: 30px auto;
        background-color: #fff;
        border-radius: 4px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        padding: 25px;
        border: 1px solid #ddd;
        animation: fadeIn 0.4s ease-out;
    }

    .password-header {
        border-bottom: 1px solid #e7e7e7;
        padding-bottom: 15px;
        margin-bottom: 25px;
    }

        .password-header h2 {
            font-weight: 400;
            color: #111;
            font-size: 1.8rem;
            margin-bottom: 5px;
        }

        .password-header p {
            color: #555;
            font-size: 0.9rem;
        }

    .form-group {
        margin-bottom: 20px;
    }

        .form-group label {
            font-weight: 700;
            color: #111;
            margin-bottom: 8px;
            display: block;
        }

    .password-input-container {
        position: relative;
        display: flex;
        align-items: center;
    }

    .form-control {
        border: 1px solid #a6a6a6;
        border-radius: 4px;
        padding: 10px 35px 10px 10px;
        width: 100%;
        font-size: 1rem;
        transition: all 0.3s ease;
    }

        .form-control:focus {
            border-color: #e77600;
            box-shadow: 0 0 3px 2px rgba(228,121,17,.5);
            outline: none;
        }

    .password-toggle {
        position: absolute;
        right: 10px;
        top: 50%;
        transform: translateY(-50%);
        cursor: pointer;
        color: #767676;
        background: none;
        border: none;
        padding: 0;
        font-size: 1rem;
    }

        .password-toggle:hover {
            color: #0066c0;
        }

    .password-strength {
        height: 4px;
        background: #e7e7e7;
        margin-top: 8px;
        border-radius: 2px;
        overflow: hidden;
        position: relative;
    }

    .password-strength-bar {
        height: 100%;
        width: 0;
        transition: width 0.3s ease, background 0.3s ease;
    }

    .password-hints {
        font-size: 0.8rem;
        color: #767676;
        margin-top: 5px;
    }

    .password-match {
        color: #2fa12f;
        display: none;
        font-size: 0.85rem;
        margin-top: 5px;
    }

    .btn-amazon-save {
        background: linear-gradient(to bottom,#f7dfa5,#f0c14b);
        border-radius: 3px;
        border: 1px solid #a88734;
        color: #111;
        font-weight: 500;
        padding: 10px 20px;
        font-size: 1rem;
        cursor: pointer;
        transition: all 0.2s;
        width: 100%;
        max-width: 200px;
        margin-top: 10px;
    }

        .btn-amazon-save:hover {
            background: linear-gradient(to bottom,#f5d78e,#eeb933);
            border-color: #9c7e31;
            transform: translateY(-1px);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .btn-amazon-save:disabled {
            background: #e7e7e7;
            border-color: #a6a6a6;
            color: #767676;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

    .text-danger {
        color: #c40000;
        font-size: 0.85rem;
        margin-top: 5px;
        display: block;
    }

    @@keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(10px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    /* Responsive adjustments */
    @@media (max-width: 576px) {
        .password-change-container {
            padding: 20px 15px;
            margin: 20px 10px;
        }

        .btn-amazon-save {
            max-width: 100%;
        }
    }
</style>

<div class="password-change-container">
    <div class="password-header">
        <h2>Change Password</h2>
        <p>Create a strong, unique password to protect your account</p>
    </div>

    <form asp-action="ChangePassword" method="post" id="passwordForm">
        <div class="form-group">
            <label asp-for="CurrentPassword">Current Password</label>
            <div class="password-input-container">
                <input asp-for="CurrentPassword" class="form-control" type="password" />
                <button type="button" class="password-toggle" onclick="togglePassword('CurrentPassword')">
                    <i class="fas fa-eye"></i>
                </button>
            </div>
            <span asp-validation-for="CurrentPassword" class="text-danger"></span>
        </div>

        <div class="form-group">
            <label asp-for="NewPassword">New Password</label>
            <div class="password-input-container">
                <input asp-for="NewPassword" class="form-control" type="password"
                       oninput="checkPasswordStrength(this.value)" />
                <button type="button" class="password-toggle" onclick="togglePassword('NewPassword')">
                    <i class="fas fa-eye"></i>
                </button>
            </div>
            <div class="password-strength">
                <div class="password-strength-bar" id="passwordStrengthBar"></div>
            </div>
            <div class="password-hints">
                <div><i class="fas fa-info-circle"></i> Use at least 8 characters</div>
                <div><i class="fas fa-info-circle"></i> Include numbers and symbols</div>
            </div>
            <span asp-validation-for="NewPassword" class="text-danger"></span>
        </div>

        <div class="form-group">
            <label asp-for="ConfirmPassword">Re-enter New Password</label>
            <div class="password-input-container">
                <input asp-for="ConfirmPassword" class="form-control" type="password"
                       oninput="checkPasswordMatch()" />
                <button type="button" class="password-toggle" onclick="togglePassword('ConfirmPassword')">
                    <i class="fas fa-eye"></i>
                </button>
            </div>
            <div class="password-match" id="passwordMatch">
                <i class="fas fa-check-circle"></i> Passwords match
            </div>
            <span asp-validation-for="ConfirmPassword" class="text-danger"></span>
        </div>

        <button type="submit" class="btn-amazon-save" id="saveButton" disabled>
            Save changes
        </button>
    </form>
</div>

<script>
    // Password visibility toggle
    function togglePassword(fieldId) {
        const input = document.querySelector(`input[name="${fieldId}"]`);
        const icon = document.querySelector(`input[name="${fieldId}"] + .password-toggle i`);

        if (input.type === 'password') {
            input.type = 'text';
            icon.classList.replace('fa-eye', 'fa-eye-slash');
        } else {
            input.type = 'password';
            icon.classList.replace('fa-eye-slash', 'fa-eye');
        }
    }

    // Password strength checker
    function checkPasswordStrength(password) {
        const strengthBar = document.getElementById('passwordStrengthBar');
        let strength = 0;

        // Length check
        if (password.length >= 8) strength += 1;
        if (password.length >= 12) strength += 1;

        // Complexity checks
        if (/[A-Z]/.test(password)) strength += 1;
        if (/[0-9]/.test(password)) strength += 1;
        if (/[^A-Za-z0-9]/.test(password)) strength += 1;

        // Update strength bar
        const width = (strength / 5) * 100;
        strengthBar.style.width = width + '%';

        // Update color
        if (width < 40) {
            strengthBar.style.background = '#c40000';
        } else if (width < 70) {
            strengthBar.style.background = '#ff9900';
        } else {
            strengthBar.style.background = '#2fa12f';
        }

        checkFormValidity();
    }

    // Password match checker
    function checkPasswordMatch() {
        const newPassword = document.querySelector('input[name="NewPassword"]').value;
        const confirmPassword = document.querySelector('input[name="ConfirmPassword"]').value;
        const matchElement = document.getElementById('passwordMatch');

        if (confirmPassword.length > 0 && newPassword === confirmPassword) {
            matchElement.style.display = 'block';
        } else {
            matchElement.style.display = 'none';
        }

        checkFormValidity();
    }

    // Form validation checker
    function checkFormValidity() {
        const currentPassword = document.querySelector('input[name="CurrentPassword"]').value;
        const newPassword = document.querySelector('input[name="NewPassword"]').value;
        const confirmPassword = document.querySelector('input[name="ConfirmPassword"]').value;
        const saveButton = document.getElementById('saveButton');

        const isValid = currentPassword.length > 0 &&
                       newPassword.length >= 8 &&
                       newPassword === confirmPassword;

        saveButton.disabled = !isValid;
    }

    // Initialize form validation
    document.querySelectorAll('input[type="password"]').forEach(input => {
        input.addEventListener('input', checkFormValidity);
    });
</script>

<!-- Font Awesome for icons -->
<script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
